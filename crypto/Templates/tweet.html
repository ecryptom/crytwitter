{% extends 'base.html' %}
{% load static %}

{% block header %}
    <title>ارز توييتر</title>
    <link rel="stylesheet" href="{% static 'css/tweet.min.css' %}" />

    <style>
        .tweet-content-center{
            height:600px;
            overflow: scroll;
        }
        .tweet-content-center::-webkit-scrollbar {
    width: 6px;
    background-color: white;
}

.tweet-content-center::-webkit-scrollbar-track {
    border-radius: 2px;
}

.tweet-content-center::-webkit-scrollbar-thumb {
    background: #ddd;
    border-radius: 2px;
    transition: all ease .5s;
}


    </style>

{% endblock header %}



{% block page %}
    <section class="tweet">
        <div class="container-fluid">
            <div class="tweet-header">
                <div class="tweet-header-search">
                </div>
                <div class="tweet-header-details">

                </div>
            </div>
            <div class="tweet-content">
                <div class="row">
                    <div class="'col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3">
                        <div class="tweet-content-right">
                            <h2 class="tweet-content-right-heading-two">محصولات</h2>
                            <div class="tweet-content-right-products">
                                <ul class="tweet-content-right-products-list">
                                    <li class="tweet-content-right-products-item">
                                        <a class="tweet-content-right-products-link">اختصاصی معاملاتی</a>
                                    </li>
                                    <li class="tweet-content-right-products-item" data-toggle="collapse"
                                        data-target="#question-1">
                                        <a href="#" class="tweet-content-right-products-link">
                                            سبد پیشنهادی
                                            <i class="fa fa-plus tweet-content-right-products-icon"></i>
                                        </a>
                                        <ul class="tweet-content-right-products-sub-list collapse" id="question-1">
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">سبد بلند مدت</a>
                                            </li>
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">سبد میان مدت</a>
                                            </li>
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">سبد کوتاه مدت</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="tweet-content-right-products-item">
                                        <a class="tweet-content-right-products-link">کیف پول فیزیکی</a>
                                    </li>
                                    <li class="tweet-content-right-products-item" data-toggle="collapse"
                                        data-target="#question-2">
                                        <a href="#" class="tweet-content-right-products-link">
                                            محصولات آموزشی
                                            <i class="fa fa-plus tweet-content-right-products-icon"></i>
                                        </a>
                                        <ul class="tweet-content-right-products-sub-list collapse" id="question-2">
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">تحلیل تکنیکال</a>
                                            </li>
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">تحلیل بنیادی</a>
                                            </li>
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">تحلیل کلاسیک</a>
                                            </li>
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">روانشناسی بازار</a>
                                            </li>
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">استراتژی معاملاتی</a>
                                            </li>
                                            <li class="tweet-content-right-products-sub-item">
                                                <a class="tweet-content-right-products-link">کتاب های آموزشی</a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="'col-12 col-sm-12 col-md-12 col-lg-6 col-xl-6">
                        <div class="tweet-content-center">
                            <form action="{% url 'tweet' %}" method="POST">
                                {% csrf_token %}
                                <textarea class="tweet-content-center-text-area" name="text"
                                    placeholder="نظرات،تحلیل ها،اخبار،شنیده ها و سوالات خود را با ما به اشتراک بگذارید."></textarea>
                                <button class="tweet-content-center-submit" type="submit">
                                    <i class="fa fa-twitter"></i>
                                </button>
                            </form>
                            <div class="tweet-content-center-boxes-wrapper">
                                {% for tweet in tweets  %}
                                    <div id="tweet-{{tweet.id}}" class="tweet-content-center-boxes">
                                    {% if tweet.reply_to %}
                                        <div class="tweet-content-center-boxes-parent">
                                            <a href="#tweet-{{tweet.id}}" class="tweet-content-center-boxes-parent-link tweet-scroll">
                                             <div class="tweet-content-center-boxes-parent-header">
                                                 <img src="{{tweet.reply_to.user.image.url}}" class="tweet-content-center-boxes-parent-header-image" />
                                                 <span class="tweet-content-center-boxes-parent-user-name"></span>
                                             </div>
                                             <div class="tweet-content-center-boxes-parent-body">
                                                 <p class="tweet-content-center-boxes-parent-body-paragraph">
                                                     {{tweet.reply_to.text}}
                                                 </p>
                                             </div>
                                            </a>
                                             </div>  
                                    {% endif %}
                                        
                                        <div class="tweet-content-center-boxes-reply">
                                            <div class="tweet-content-center-boxes-reply-header">
                                                <img class="tweet-content-center-boxes-reply-header-image" src="{{tweet.user.image.url}}"
                                                    alt="کاربر پیش فرض">
                                                <span class="tweet-content-center-boxes-reply-user-name">{{tweet.user.name}}</span>
                                                <span class="tweet-content-center-boxes-reply-header-time"></span>
                                                <a class="" data-toggle="collapse" data-target="#tweet-report-{{tweet.id}}">
                                                    <i class="fa fa-ellipsis-v tweet-content-center-boxes-reply-header-icon"></i>
                                                </a>
                                                <div class="tweet-content-center-boxes-reply-header-report collapse"
                                                    id="tweet-report-{{tweet.id}}">
                                                    <ul class="tweet-content-center-boxes-reply-header-report-list">
                                                        <li class="tweet-content-center-boxes-reply-header-report-item">
                                                            <a href="">
                                                                <i class="fa fa-ban"></i>
                                                                توهین و الفاظ رکیک
                                                            </a>
                                                        </li>
                                                        <li class="tweet-content-center-boxes-reply-header-report-item">
                                                            <a href="">
                                                                <i class="fa fa-exclamation-circle"></i>
                                                                توییت تکراری
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="tweet-content-center-boxes-reply-body">
                                                <p class="tweet-content-center-boxes-reply-body-paragraph">
                                                    {{tweet.text}}
                                                </p>
                                            </div>
                                            <div class="tweet-content-center-boxes-reply-footer">
                                                <div class="tweet-content-center-boxes-reply-footer-like">
                                                    <a onclick="like_tweet({{tweet.id}})" href="#" class="tweet-content-center-boxes-reply-footer-like-link">
                                                    {% if user in tweet.likes.all %}
                                                        <i id="like_icon_{{tweet.id}}" class="fa fa-heart tweet-content-center-boxes-reply-footer-like-icon tweet-content-center-boxes-reply-footer-like-icon-active"></i>
                                                    {% else %}
                                                        <i id="like_icon_{{tweet.id}}" class="fa fa-heart-o tweet-content-center-boxes-reply-footer-like-icon tweet-content-center-boxes-reply-footer-like-icon-active"></i>
                                                    {% endif %}
                                                    </a>
                                                    <span id="likes_{{tweet.id}}" class="tweet-content-center-boxes-reply-footer-like-count">{{tweet.likes.count}}</span>
                                                </div>  
                                                <div class="tweet-content-center-boxes-reply-footer-retweet">
                                                  <i class="fa fa-reply tweet-content-center-boxes-reply-footer-icon"></i>
                                             </div>
                                              </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="'col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3">
                        <div class="tweet-content-left">
                            <div class="tweet-content-left-tab">
                                <ul class="nav nav-tabs tweet-content-left-tab-list" role="tablist">
                                    <li class="nav-item tweet-content-left-tab-item">
                                        <a class="nav-link active tweet-content-left-tab-link" id="home-tab"
                                            data-toggle="tab" href="#clock" role="tab">
                                            <i class="fas fa-clock-o"></i>
                                            ساعت های جهانی
                                        </a>
                                    </li>
                                    <li class="nav-item tweet-content-left-tab-item">
                                        <a class="nav-link tweet-content-left-tab-link" id="profile-tab"
                                            data-toggle="tab" href="#profile" role="tab">
                                            <i class="far fa-chart-bar"></i>
                                            نرخ های جهانی
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content tweet-content-left-tab-content">
                                    <div class="tab-pane fade show active tweet-content-left-tab-content-clock"
                                        id="clock" role="tabpanel">
                                        <ul class="tweet-content-left-tab-content-clock-list">

                                            <li class="tweet-content-left-tab-content-clock-item">
                                                <span class="tweet-content-left-tab-content-clock-title">برزیل :</span>
                                                <span class="tweet-content-left-tab-content-clock-value">12:50</span>
                                            </li>
                                            <li class="tweet-content-left-tab-content-clock-item">
                                                <span class="tweet-content-left-tab-content-clock-title">برزیل :</span>
                                                <span class="tweet-content-left-tab-content-clock-value">12:50</span>
                                            </li>
                                            <li class="tweet-content-left-tab-content-clock-item">
                                                <span class="tweet-content-left-tab-content-clock-title">برزیل :</span>
                                                <span class="tweet-content-left-tab-content-clock-value">12:50</span>
                                            </li>
                                            <li class="tweet-content-left-tab-content-clock-item">
                                                <span class="tweet-content-left-tab-content-clock-title">برزیل :</span>
                                                <span class="tweet-content-left-tab-content-clock-value">12:50</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="tab-pane fade" id="profile" role="tabpanel">2</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock page %}
    

    {% block scripts %}
    
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <script src="{% static 'js/swiper.min.js' %}"></script>
    <script src="{% static 'js/wow.min.js' %}"></script>
    <script src="{% static 'js/num-scroller.js' %}"></script>

    
    <script>
   let sendReplyIcon = document.querySelectorAll(".fa.fa-reply.tweet-content-center-boxes-footer-icon");
    let sendReplyBox = document.querySelectorAll(".tweet-content-center-boxes-send-reply");
    sendReplyIcon.forEach(element => {
        element.addEventListener("click", function (e) {
            let firstParent = e.target.parentElement.parentElement;
            let replyBox = firstParent.querySelector(".tweet-content-center-boxes-send-reply");
            if (replyBox == null) {
                let replyComments = firstParent.querySelector(".tweet-content-center-boxes-reply");
                let replyElement = document.createElement("div");
                replyElement.classList.add("tweet-content-center-boxes-send-reply");
                replyElement.innerHTML = "  <form action='{% url 'tweet' %}' method='POST'><textarea placeholder='متن دیدگاه' class='tweet-content-center-boxes-send-reply-text-area'></textarea><button type='submit' class='tweet-content-center-boxes-send-reply-submit'>ارسال پاسخ</button></form>";
                firstParent.insertBefore(replyElement, replyComments);
                replyElement.style.height = replyElement.scrollHeight + "px";
                e.target.classList.add("tweet-content-center-boxes-footer-icon-close");
            } else if (getComputedStyle(replyBox).height == "0px") {
                replyBox.style.height = replyBox.scrollHeight + "px";
                e.target.classList.add("tweet-content-center-boxes-footer-icon-close");
            } else {
                replyBox.style.height = "0px";
                e.target.classList.remove("tweet-content-center-boxes-footer-icon-close");
                setTimeout(function(){
                    firstParent.removeChild(replyBox);
                },1000);
            }
        })
    });


function like_tweet(ID){
    $.ajax({
        url: 'like_tweet/' + ID,
        type: 'GET',
        dataType: "json",
        success: function(resp, s, x) {
            if(resp.status == 'like'){
                document.getElementById('likes_'+ID).innerHTML = parseInt(document.getElementById('likes_'+ID).innerHTML) + 1;
                document.getElementById('like_icon_'+ID).classList.remove('fa-heart-o');
                document.getElementById('like_icon_'+ID).classList.add('fa-heart');
                //document.getElementById('like_icon_'+ID).class = "fa fa-heart tweet-content-center-boxes-reply-footer-like-icon tweet-content-center-boxes-reply-footer-like-icon-active";
            }else{
                document.getElementById('likes_'+ID).innerHTML = parseInt(document.getElementById('likes_'+ID).innerHTML) - 1;
                document.getElementById('like_icon_'+ID).classList.remove('fa-heart');
                document.getElementById('like_icon_'+ID).classList.add('fa-heart-o');
                //document.getElementById('like_icon_'+ID).clas = "fa fa-heart-o tweet-content-center-boxes-reply-footer-like-icon tweet-content-center-boxes-reply-footer-like-icon-active"
            }   
            }
    });
}
    



    
    </script>

    {% endblock scripts %}

